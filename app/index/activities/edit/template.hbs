{{#let (changeset @model this.validations) as |cs|}}
<form data-test-activity-edit-form {{on "submit" (fn this.save cs)}}>
  <div class="card">
    <div class="card-header hidden-lg">
      <LinkTo @route={{'index.activities'}} >{{fa-icon 'chevron-left'}}</LinkTo>
    </div>
    <div class="card-block">
      <TaskSelection @task={{cs.task}} as |t|>
        <div class="form-group">{{t.customer}}</div>
        <div class="form-group">{{t.project}}</div>
        <div class="form-group">{{t.task}}</div>
      </TaskSelection>
    </div>
    <div class="card-footer text-right">
      <div class="form-group">
        <Input
          type="text"
          class="form-control comment-field"
          placeholder="Comment"
          name="comment"
          @value={{cs.comment}}
        />
        {{#if cs.task.project.customerVisible }}
          <CustomerVisibleIcon class="customer-visible-icon" />
        {{/if}}
      </div>
      <div class="form-group checkboxes">
        <SyCheckbox
          data-test-activity-review
          @checked={{cs.review}}
          @label={{'Needs review'}}
          @onChange={{(toggle "review" cs)}}
        />
        <SyCheckbox
          data-test-activity-not-billable
          @checked={{cs.notBillable}}
          @label='Not billable'
          @onChange={{(toggle "notBillable" cs)}}
        />
      </div>
      <table class="table table--striped table--activity-edit">
        <tbody>
          <tr
            data-test-activity-block-row
          >
            <td class="form-group {{if cs.error.from 'has-error'}}">
              <SyTimepicker 
                @value={{cs.from}}
                @max={{cs.to}}
                @precision={{1}}
                @focusOut={{(fn this.validateChangeset cs) }}
                @onChange={{(fn (mut cs.from))}}
                />
            </td>
            <td>-</td>
            <td class="form-group {{if cs.error.to 'has-error'}}">
              <SyTimepicker
                @value={{cs.to}}
                @min={{cs.from}}
                @precision={{1}}
                @disabled={{(if cs.active true)}}
                @focusOut={{(fn this.validateChangeset cs)}}
                @onChange={{(fn (mut cs.to))}}
                />
            </td>
          </tr>
        </tbody>
      </table>
    </div>
    <div class="card-footer text-right">
      <button class="btn btn-danger" type="button" disabled={{@model.active}} {{ on "click" (fn this.delete @model)}} data-test-activity-edit-form-delete>Delete</button>
      <button class="btn btn-primary" type="submit" disabled={{not (and cs.isDirty cs.isValid)}} data-test-activity-edit-form-save>Save</button>
    </div>
  </div>
</form>
{{/let}}
